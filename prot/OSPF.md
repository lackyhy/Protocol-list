**OSPF** (Open Shortest Path First) — протокол динамической маршрутизации внутри одной автономной системы. OSPF использует алгоритм Дейкстры для поиска кратчайшего пути и является link-state протоколом.

## **Основные характеристики**

| Параметр                    | Описание                                                                 |
| --------------------------- | ------------------------------------------------------------------------ |
| **Уровень OSI**             | Прикладной (Application Layer)                                           |
| **Транспорт**               | IP (протокол 89)                                                         |
| **Тип протокола**           | Link-State (состояние каналов)                                           |
| **Назначение**              | Внутренняя маршрутизация (IGP)                                           |
| **Алгоритм**                | Dijkstra (SPF - Shortest Path First)                                     |
| **Версии**                  | OSPFv2 (IPv4), OSPFv3 (IPv6)                                             |

## **OSPF области (Areas)**

### **Иерархия областей**

```
Area 0 (Backbone)
├── Area 1
├── Area 2
└── Area 3
```

**Типы областей:**
- **Backbone Area (Area 0)** — центральная область
- **Standard Area** — обычная область
- **Stub Area** — заглушка (нет внешних маршрутов)
- **Totally Stubby Area** — полностью заглушка
- **NSSA** (Not-So-Stubby Area) — особая заглушка

## **OSPF типы маршрутизаторов**

| Тип           | Описание                                    |
| ------------- | ------------------------------------------- |
| **Internal Router** | Все интерфейсы в одной области            |
| **Backbone Router** | Интерфейс в Area 0                          |
| **Area Border Router (ABR)** | Интерфейсы в разных областях            |
| **Autonomous System Boundary Router (ASBR)** | Подключен к внешней AS              |

## **OSPF пакеты**

### **Типы пакетов**

| Тип | Название        | Описание                                    |
| --- | --------------- | ------------------------------------------- |
| 1   | Hello           | Обнаружение соседей                         |
| 2   | Database Description | Описание базы данных                |
| 3   | Link State Request | Запрос состояния канала                |
| 4   | Link State Update | Обновление состояния канала            |
| 5   | Link State Acknowledgment | Подтверждение              |

## **Процесс OSPF**

### **1. Обнаружение соседей (Hello)**

```
Router A                          Router B
  |                                 |
  |-------- Hello -----------------→|
  |         (Router ID, Area ID)    |
  |                                 |
  |←------- Hello ------------------|
  |         (Router ID, Area ID)    |
  |                                 |
  |     Соседи установлены          |
```

### **2. Обмен базами данных**

```
Router A                          Router B
  |                                 |
  |-------- DBD --------------------→|
  |         (LSA headers)            |
  |                                 |
  |←------- DBD --------------------|
  |         (LSA headers)           |
  |                                 |
  |-------- LSR --------------------→|
  |         (Request LSAs)          |
  |                                 |
  |←------- LSU --------------------|
  |         (LSAs)                  |
  |                                 |
  |-------- LSAck -----------------→|
  |                                 |
  |     Базы данных синхронизированы |
```

### **3. Вычисление SPF**

После синхронизации каждый маршрутизатор:
1. Строит граф сети
2. Вычисляет кратчайшие пути (Dijkstra)
3. Создаёт таблицу маршрутизации

## **LSA (Link State Advertisement)**

### **Типы LSA**

| Тип | Название        | Описание                                    |
| --- | --------------- | ------------------------------------------- |
| 1   | Router LSA      | Локальные каналы маршрутизатора             |
| 2   | Network LSA     | Каналы сети (от DR)                         |
| 3   | Summary LSA     | Сводка сети (от ABR)                        |
| 4   | ASBR Summary LSA | Сводка ASBR (от ABR)                      |
| 5   | AS External LSA | Внешние маршруты (от ASBR)                  |
| 7   | NSSA External LSA | Внешние маршруты в NSSA (от ASBR)        |

## **DR/BDR (Designated Router / Backup DR)**

### **Концепция**

В broadcast сетях выбираются:
- **DR** (Designated Router) — назначенный маршрутизатор
- **BDR** (Backup DR) — резервный DR

**Функции:**
- Уменьшение количества LSA
- Централизация обмена информацией

## **Примеры конфигурации**

### **Cisco IOS**

```
router ospf 1
 router-id 1.1.1.1
 network 192.168.1.0 0.0.0.255 area 0
 network 10.0.0.0 0.0.0.255 area 1
 default-information originate
```

### **Linux (FRR)**

```bash
router ospf
 ospf router-id 1.1.1.1
 network 192.168.1.0/24 area 0
 network 10.0.0.0/24 area 1
 default-information originate
```

### **BIRD**

```
protocol ospf v2 {
    area 0.0.0.0 {
        interface "eth0" {
            cost 10;
        };
        network 192.168.1.0/24;
    };
}
```

## **Метрика OSPF**

### **Расчёт стоимости**

Стоимость = 10^8 / Пропускная способность (бит/с)

| Пропускная способность | Стоимость |
| ---------------------- | --------- |
| 100 Мбит/с             | 1         |
| 10 Мбит/с              | 10        |
| 1 Мбит/с               | 100       |
| 100 Кбит/с             | 1000      |

## **Применение OSPF**

1. **Корпоративные сети** — внутренняя маршрутизация
2. **Крупные сети** — масштабируемая маршрутизация
3. **Сети провайдеров** — внутренняя маршрутизация
4. **Гибридные сети** — комбинация с другими протоколами

## **Ограничения OSPF**

1. **Сложность** — сложная настройка
2. **Ресурсы** — требует памяти и CPU
3. **Конвергенция** — может быть медленной
4. **Области** — требует правильного дизайна

## **Будущее OSPF**

- **OSPFv3** — расширенное использование для IPv6
- **Улучшенная производительность** — оптимизация
- **Безопасность** — новые методы аутентификации
- **Интеграция** — с современными сетями
