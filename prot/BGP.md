**BGP** (Border Gateway Protocol) — протокол маршрутизации между автономными системами (разными провайдерами). BGP фактически "склеивает" интернет в единое целое, позволяя различным сетям обмениваться информацией о маршрутах.

## **Основные характеристики**

| Параметр                    | Описание                                                                 |
| --------------------------- | ------------------------------------------------------------------------ |
| **Уровень OSI**             | Прикладной (Application Layer)                                           |
| **Транспорт**               | TCP (порт 179)                                                           |
| **Тип протокола**           | Path Vector (путевой вектор)                                            |
| **Назначение**              | Маршрутизация между автономными системами                                |
| **Версии**                  | BGP-4 (текущая, для IPv4), MP-BGP (для IPv6 и других)                   |
| **Применение**              | Интернет, крупные корпоративные сети                                     |

## **Автономные системы (AS)**

### **Концепция**

Автономная система (AS) — группа сетей под единым административным контролем.

**Типы AS:**
- **Stub AS** — подключена к одному провайдеру
- **Multihomed AS** — подключена к нескольким провайдерам (не транзитная)
- **Transit AS** — передаёт трафик между другими AS

### **ASN (Autonomous System Number)**

Уникальный номер AS:
- **16-битные** (1-65535) — для IPv4
- **32-битные** (1-4294967295) — расширенные

## **BGP сообщения**

### **Типы сообщений**

| Тип | Название        | Описание                                    |
| --- | --------------- | ------------------------------------------- |
| 1   | OPEN            | Открытие BGP сессии                         |
| 2   | UPDATE          | Обновление маршрутов                        |
| 3   | NOTIFICATION    | Уведомление об ошибке                       |
| 4   | KEEPALIVE       | Поддержание соединения                      |

## **BGP атрибуты**

### **Типы атрибутов**

| Атрибут           | Тип    | Описание                                    |
| ----------------- | ------ | ------------------------------------------- |
| **ORIGIN**        | Well-known mandatory | Источник маршрута (IGP, EGP, Incomplete) |
| **AS_PATH**       | Well-known mandatory | Список пройденных AS                        |
| **NEXT_HOP**      | Well-known mandatory | Следующий хоп                               |
| **LOCAL_PREF**    | Well-known discretionary | Локальный приоритет                        |
| **ATOMIC_AGGREGATE** | Well-known discretionary | Атомарная агрегация                    |
| **AGGREGATOR**    | Optional transitive | Агрегатор                                  |
| **COMMUNITY**     | Optional transitive | Сообщество                                 |
| **MED**           | Optional non-transitive | Multi-Exit Discriminator                |

## **Процесс установления BGP сессии**

```
Router A                          Router B
  |                                 |
  |-------- TCP:179 ----------------→|
  |                                 |
  |←------- TCP:179 ----------------|
  |                                 |
  |-------- OPEN -------------------→|
  |         (AS, BGP ID, Hold Time) |
  |                                 |
  |←------- OPEN -------------------|
  |         (AS, BGP ID, Hold Time) |
  |                                 |
  |-------- KEEPALIVE -------------→|
  |                                 |
  |←------- KEEPALIVE --------------|
  |                                 |
  |     BGP сессия установлена      |
  |     Обмен UPDATE сообщениями    |
```

## **Примеры конфигурации**

### **Cisco IOS**

```
router bgp 65001
 bgp router-id 192.168.1.1
 neighbor 192.168.1.2 remote-as 65002
 neighbor 192.168.1.2 update-source Loopback0
 !
 address-family ipv4
  network 10.0.0.0 mask 255.255.255.0
  neighbor 192.168.1.2 activate
 exit-address-family
```

### **Linux (FRR/BIRD)**

```bash
# FRR (Free Range Routing)
router bgp 65001
 bgp router-id 192.168.1.1
 neighbor 192.168.1.2 remote-as 65002
 !
 address-family ipv4
  network 10.0.0.0/24
  neighbor 192.168.1.2 activate
 exit-address-family
```

### **BIRD**

```
router id 192.168.1.1;

protocol bgp peer1 {
    local as 65001;
    neighbor 192.168.1.2 as 65002;
    export filter {
        if net = 10.0.0.0/24 then accept;
    };
}
```

## **BGP фильтрация**

### **Route Maps**

```
route-map INBOUND permit 10
 match as-path 1
 set local-preference 200

route-map OUTBOUND permit 10
 match community 1
 set metric 100

ip as-path access-list 1 permit ^65002$
ip community-list 1 permit 65002:100
```

## **Применение BGP**

1. **Интернет** — маршрутизация между провайдерами
2. **Крупные сети** — корпоративные сети с множественными подключениями
3. **CDN** — распределение контента
4. **Multihoming** — подключение к нескольким провайдерам
5. **Транзит** — предоставление транзита другим сетям

## **Ограничения BGP**

1. **Сложность** — сложная настройка и управление
2. **Безопасность** — уязвим к атакам (hijacking)
3. **Конвергенция** — медленная сходимость
4. **Масштабируемость** — проблемы при большом количестве маршрутов

## **Безопасность BGP**

### **Угрозы**

1. **Route Hijacking** — перехват маршрутов
2. **Route Leaking** — утечка маршрутов
3. **AS Path Manipulation** — манипуляция путём

### **Защита**

1. **Route Filtering** — фильтрация маршрутов
2. **RPKI** — Resource Public Key Infrastructure
3. **BGPsec** — подпись маршрутов
4. **Prefix Filtering** — фильтрация префиксов

## **Будущее BGP**

- **BGPsec** — подпись маршрутов
- **RPKI** — проверка авторизации
- **Улучшенная безопасность** — новые методы
- **Оптимизация** — улучшение производительности
