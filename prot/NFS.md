**NFS** (Network File System) — протокол для доступа к файлам по сети в UNIX- и Linux-системах, позволяющий монтировать удалённые каталоги как локальные. NFS разработан Sun Microsystems и широко используется в корпоративных сетях.

## **Основные характеристики**

| Параметр                    | Описание                                                                 |
| --------------------------- | ------------------------------------------------------------------------ |
| **Уровень OSI**             | Прикладной (Application Layer)                                           |
| **Транспорт**               | TCP, UDP (порт 2049)                                                     |
| **Тип протокола**           | Клиент-сервер                                                            |
| **Назначение**              | Сетевой доступ к файлам                                                  |
| **Версии**                  | NFSv2, NFSv3, NFSv4, NFSv4.1, NFSv4.2                                   |
| **Безопасность**            | Kerberos, ACL (в NFSv4)                                                  |

## **Версии NFS**

### **NFSv2**

- 32-битные файлы (до 2GB)
- UDP транспорт
- Базовые функции
- Устаревший

### **NFSv3**

- 64-битные файлы
- TCP транспорт
- Асинхронная запись
- Широко используется

### **NFSv4**

- Улучшенная безопасность
- Состояние (stateful)
- Объединённые операции
- ACL поддержка

### **NFSv4.1**

- Parallel NFS (pNFS)
- Улучшенная производительность
- Сессии

### **NFSv4.2**

- Server-side copy
- Sparse files
- Space reservations

## **Настройка NFS сервера**

### **Linux**

```bash
# Установка
sudo apt-get install nfs-kernel-server

# Экспорт директории
echo "/export/shared *(rw,sync,no_subtree_check)" | sudo tee -a /etc/exports

# Или детальная настройка
cat >> /etc/exports <<EOF
/export/shared 192.168.1.0/24(rw,sync,no_subtree_check)
/export/public *(ro,sync,no_subtree_check)
EOF

# Перезагрузка экспортов
sudo exportfs -ra

# Запуск сервиса
sudo systemctl start nfs-kernel-server
sudo systemctl enable nfs-kernel-server
```

### **Параметры экспорта**

| Параметр      | Описание                                    |
| ------------- | ------------------------------------------- |
| **ro**        | Только чтение                               |
| **rw**        | Чтение и запись                             |
| **sync**      | Синхронная запись                           |
| **async**     | Асинхронная запись                          |
| **no_subtree_check** | Отключить проверку поддерева        |
| **no_root_squash** | Не маппить root на nobody          |
| **root_squash** | Маппить root на nobody (безопаснее)  |

## **Настройка NFS клиента**

### **Linux**

```bash
# Установка
sudo apt-get install nfs-common

# Просмотр доступных экспортов
showmount -e server.example.com

# Монтирование
sudo mount -t nfs server.example.com:/export/shared /mnt/nfs

# Автоматическое монтирование (/etc/fstab)
server.example.com:/export/shared /mnt/nfs nfs defaults 0 0

# Монтирование
sudo mount -a
```

### **Параметры монтирования**

| Параметр      | Описание                                    |
| ------------- | ------------------------------------------- |
| **soft**      | Мягкое монтирование (таймаут)               |
| **hard**      | Жёсткое монтирование (повторные попытки)    |
| **intr**      | Прерываемое (Ctrl+C)                        |
| **rsize**     | Размер чтения (8192, 16384)                  |
| **wsize**     | Размер записи (8192, 16384)                 |
| **timeo**     | Таймаут (в десятых долях секунды)           |

## **Примеры использования**

### **Монтирование**

```bash
# Временное монтирование
sudo mount -t nfs4 server.example.com:/export/shared /mnt/nfs

# С параметрами
sudo mount -t nfs4 -o rsize=8192,wsize=8192,timeo=14 \
  server.example.com:/export/shared /mnt/nfs

# Размонтирование
sudo umount /mnt/nfs
```

### **Автоматическое монтирование**

```bash
# /etc/fstab
server.example.com:/export/shared /mnt/nfs nfs4 \
  defaults,rsize=8192,wsize=8192,timeo=14 0 0
```

### **Проверка монтирования**

```bash
# Список монтированных NFS
mount | grep nfs

# Статистика
nfsstat

# Просмотр экспортов
exportfs -v
```

## **Безопасность NFS**

### **NFSv4 с Kerberos**

```bash
# Настройка Kerberos
# /etc/exports
/export/shared *(sec=krb5:krb5i:krb5p,rw,sync)

# Монтирование с Kerberos
sudo mount -t nfs4 -o sec=krb5 server.example.com:/export/shared /mnt/nfs
```

### **Рекомендации**

1. **Использовать NFSv4** — лучшая безопасность
2. **Ограничить доступ** — firewall правила
3. **Kerberos** — для аутентификации
4. **VPN** — для дополнительной защиты
5. **Ограничить экспорты** — только необходимые директории

## **Производительность NFS**

### **Оптимизация**

1. **Размеры блоков** — rsize/wsize
2. **TCP вместо UDP** — для надёжности
3. **Кеширование** — на клиенте
4. **Сеть** — быстрая сеть (Gigabit+)

### **Настройка производительности**

```bash
# Оптимальные параметры
sudo mount -t nfs4 -o \
  rsize=1048576,wsize=1048576,hard,intr,timeo=600 \
  server.example.com:/export/shared /mnt/nfs
```

## **Применение NFS**

1. **Общие файлы** — совместный доступ к файлам
2. **Хранилища данных** — централизованное хранилище
3. **Кластерные системы** — общие данные
4. **Виртуализация** — общие хранилища для VM
5. **Резервное копирование** — централизованные бэкапы

## **Ограничения NFS**

1. **Безопасность** — требует правильной настройки
2. **Производительность** — зависит от сети
3. **Совместимость** — различия в версиях
4. **Состояние** — проблемы при сбоях сети

## **Будущее NFS**

- **NFSv4.2** — новые возможности
- **Улучшенная безопасность** — новые методы
- **Производительность** — оптимизация
- **Интеграция** — с современными системами
