**WireGuard** — современный, простой и высокопроизводительный протокол VPN. WireGuard работает на уровне ядра операционной системы и использует современную криптографию. Протокол разработан для простоты, скорости и безопасности.

## **Основные характеристики**

| Параметр                    | Описание                                                                 |
| --------------------------- | ------------------------------------------------------------------------ |
| **Уровень OSI**             | Сетевой (Network Layer)                                                   |
| **Транспорт**               | UDP (порт по выбору, обычно 51820)                                       |
| **Тип протокола**           | VPN туннель                                                               |
| **Криптография**            | ChaCha20, Poly1305, Curve25519, BLAKE2s                                  |
| **Производительность**     | Очень высокая (работает в ядре)                                           |
| **Код**                     | ~4000 строк (очень компактный)                                           |
| **Безопасность**            | Современная криптография                                                  |

## **Архитектура WireGuard**

### **Компоненты**

1. **Interface** — виртуальный сетевой интерфейс (wg0, wg1 и т.д.)
2. **Peer** — удалённый узел
3. **Key Pair** — пара ключей (private/public)
4. **Allowed IPs** — разрешённые IP-адреса

### **Преимущества**

- **Простота** — минимальная конфигурация
- **Скорость** — работа в ядре
- **Безопасность** — современная криптография
- **Низкие накладные расходы** — эффективный протокол

## **Криптография WireGuard**

### **Алгоритмы**

| Компонент      | Алгоритм      | Описание                                    |
| -------------- | ------------- | ------------------------------------------- |
| **Шифрование** | ChaCha20      | Потоковое шифрование                        |
| **Аутентификация** | Poly1305    | MAC (Message Authentication Code)           |
| **Обмен ключами** | Curve25519  | Эллиптическая кривая                        |
| **Хеширование** | BLAKE2s      | Быстрое хеширование                         |
| **Случайные числа** | ChaCha20   | Генератор случайных чисел                   |

## **Настройка WireGuard**

### **Генерация ключей**

```bash
# Приватный ключ
wg genkey > private.key

# Публичный ключ
wg pubkey < private.key > public.key

# Или одной командой
wg genkey | tee private.key | wg pubkey > public.key
```

### **Конфигурация сервера**

```bash
# /etc/wireguard/wg0.conf
[Interface]
PrivateKey = <server_private_key>
Address = 10.0.0.1/24
ListenPort = 51820
PostUp = iptables -A FORWARD -i wg0 -j ACCEPT; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
PostDown = iptables -D FORWARD -i wg0 -j ACCEPT; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE

[Peer]
PublicKey = <client_public_key>
AllowedIPs = 10.0.0.2/32
```

### **Конфигурация клиента**

```bash
# /etc/wireguard/wg0.conf
[Interface]
PrivateKey = <client_private_key>
Address = 10.0.0.2/24
DNS = 8.8.8.8

[Peer]
PublicKey = <server_public_key>
Endpoint = server.example.com:51820
AllowedIPs = 0.0.0.0/0
PersistentKeepalive = 25
```

## **Управление WireGuard**

### **Запуск/остановка**

```bash
# Запуск
sudo wg-quick up wg0

# Остановка
sudo wg-quick down wg0

# Статус
sudo wg show

# Детальная информация
sudo wg show wg0 dump
```

### **Добавление пира**

```bash
# Добавление пира
sudo wg set wg0 peer <public_key> allowed-ips 10.0.0.3/32

# Сохранение конфигурации
sudo wg-quick save wg0
```

## **Примеры использования**

### **Базовое подключение**

```bash
# Сервер
sudo wg-quick up wg0

# Клиент
sudo wg-quick up wg0

# Проверка
ping 10.0.0.1
```

### **Множественные пиры**

```bash
# /etc/wireguard/wg0.conf (сервер)
[Interface]
PrivateKey = <server_private_key>
Address = 10.0.0.1/24
ListenPort = 51820

[Peer]
PublicKey = <client1_public_key>
AllowedIPs = 10.0.0.2/32

[Peer]
PublicKey = <client2_public_key>
AllowedIPs = 10.0.0.3/32
```

## **Безопасность WireGuard**

### **Рекомендации**

1. **Сильные ключи** — использовать wg genkey
2. **Ограничить AllowedIPs** — только необходимые сети
3. **Firewall** — дополнительная защита
4. **Регулярное обновление** — обновлять WireGuard

### **Преимущества безопасности**

- **Perfect Forward Secrecy** — каждый сеанс имеет уникальный ключ
- **Нет handshake** — нет уязвимостей handshake
- **Минимальная атакуемая поверхность** — простой код
- **Современная криптография** — проверенные алгоритмы

## **Производительность WireGuard**

### **Преимущества**

- **Работа в ядре** — минимальные накладные расходы
- **Эффективная криптография** — быстрые алгоритмы
- **Низкая задержка** — минимальная латентность
- **Высокая пропускная способность** — до 1 Гбит/с+

## **Применение WireGuard**

1. **Удалённый доступ** — доступ к корпоративной сети
2. **Site-to-Site VPN** — соединение сетей
3. **Мобильные устройства** — VPN на мобильных
4. **Облачные сервисы** — VPN в облаках
5. **Персональный VPN** — защита трафика

## **Сравнение с другими VPN**

| Характеристика | WireGuard | OpenVPN | IPsec |
| -------------- | --------- | ------- | ----- |
| **Производительность** | Отличная | Средняя | Хорошая |
| **Простота**    | Очень простая | Средняя | Сложная |
| **Безопасность** | Отличная | Отличная | Отличная |
| **Код**        | ~4000 строк | ~100k строк | Сложный |

## **Ограничения WireGuard**

1. **Поддержка** — не все системы поддерживают
2. **Статические IP** — требуется статический IP или динамический DNS
3. **NAT** — проблемы с некоторыми NAT
4. **Мобильность** — требует PersistentKeepalive

## **Будущее WireGuard**

- **Расширенная поддержка** — больше платформ
- **Улучшенная мобильность** — лучшая работа с мобильными сетями
- **Интеграция** — с операционными системами
- **Стандартизация** — дальнейшее развитие
